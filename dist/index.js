(()=>{"use strict";var e={9264:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getArticleListController=function(e){return n(this,void 0,void 0,(function*(){var t;const r=e.query||{},{current:n,pageSize:i}=(0,o.parseQuery)(r),d=yield(0,u.getArticleCount)(),c=yield(0,u.getArticleList)(n,i);(0,s.formatFields)(c,[{fromField:"createdAt",toField:"createdTime"},{fromField:"updatedAt",toField:"updatedTime"},{fromField:"publishedAt",toField:"publishedTime",format:"YYYY-MM-DD"}]);const f=[];for(const e of c){const r=e.articleId,n=yield(0,l.getCategoryPostsByArticleId)(r);f.push(Object.assign(Object.assign({},e),{keywords:(null===(t=e.keywords)||void 0===t?void 0:t.split(","))||[],category:n.map((e=>{var t;return{categoryId:e.articleCategoryId,categoryName:null===(t=e.articleCategory)||void 0===t?void 0:t.name}}))}))}e.body=a.default.success("获取成功！",{total:d,data:f,current:n,pageSize:i})}))},t.getArticleController=function(e){return n(this,void 0,void 0,(function*(){var t;const{articleId:r}=e.params,n=Number(r);if(isNaN(n))return void(e.body=a.default.error("参数错误！"));const i=yield(0,u.getArticleById)(n);if(!i)return void(e.body=a.default.error("文章不存在！"));(0,s.formatField)(i,[{fromField:"createdAt",toField:"createdTime"},{fromField:"updatedAt",toField:"updatedTime"},{fromField:"publishedAt",toField:"publishedTime"}]);const o=yield(0,l.getCategoryPostsByArticleId)(i.articleId),d=Object.assign({},i);d.keywords=(null===(t=i.keywords)||void 0===t?void 0:t.split(","))||[],d.category=o.map((e=>{var t;return{categoryId:e.articleCategoryId,categoryName:null===(t=e.articleCategory)||void 0===t?void 0:t.name}})),e.body=a.default.success("获取成功！",d)}))},t.saveArticle=p,t.createArticleController=function(e){return n(this,void 0,void 0,(function*(){yield p(e,null)}))},t.updateArticleController=function(e){return n(this,void 0,void 0,(function*(){const{articleId:t}=e.params,r=Number(t);isNaN(r)?e.body=a.default.error("参数错误！"):yield p(e,r)}))},t.deleteArticleController=function(e){return n(this,void 0,void 0,(function*(){const{articleId:t}=e.params,r=Number(t);if(isNaN(r))return void(e.body=a.default.error("参数错误！"));if(!(yield(0,u.getArticleById)(r)))return void(e.body=a.default.error("文章不存在！"));const i=yield prisma.$transaction((e=>n(this,void 0,void 0,(function*(){const t=yield(0,u.updateArticle)(r,{deletedAt:(0,s.now)()},e);return t&&(yield(0,l.deleteArticleCategoryPost)(t.articleId,e)),t}))));e.body=a.default.success("删除成功！",i)}))};const o=r(1141),u=r(4230),a=i(r(8953)),d=r(874),s=r(9590),l=r(9452),c=r(959),f=r(3646),y=r(4493);function p(e,t){return n(this,void 0,void 0,(function*(){const{userId:r,loginName:i}=e.state.user,p=yield(0,o.parseJson)(e),{categoryIds:m,title:h,excerpt:v,publishedAt:g}=p;let{content:_=""}=p;_=(0,c.compressHTML)(_);let{keywords:b=""}=p;const w=null!==t;let A=b;if(b instanceof Array&&(b=null==b?void 0:b.join(",")),(null==m?void 0:m.length)<=0)return void(e.body=a.default.error("分类不能为空！"));if(!h)return void(e.body=a.default.error("文章标题不能为空！"));for(let t=0;t<m.length;t++){const r=m[t];if(!(yield(0,d.getArticleCategoryById)(r)))return void(e.body=a.default.error("分类不存在！"))}let I=null;const M=yield prisma.$transaction((e=>n(this,void 0,void 0,(function*(){let n=null;w?(n=yield(0,u.updateArticle)(t,{title:h,content:_,keywords:b,excerpt:v,publishedAt:g,createId:r,creator:i,updateId:r,updater:i,createdAt:(0,s.now)(),updatedAt:(0,s.now)()},e),n&&(yield(0,l.updateArticleCategoryPost)(t,m,e)),I="更新成功！"):(n=yield(0,u.createArticle)({title:h,content:_,keywords:b,excerpt:v,publishedAt:g,createId:r,creator:i,updateId:r,updater:i,createdAt:(0,s.now)(),updatedAt:(0,s.now)()},e),n&&(yield(0,l.createArticleCategoryPost)(n.articleId,m,e)),I="创建成功！");for(const t of m){const r=yield(0,l.getArticleCountByCategoryId)(t,e);yield(0,d.updateArticleCategory)(t,{articleCount:r},e)}let o=[];for(const t of A){const r=yield(0,y.createTagService)(t,e);r&&o.push(r.id)}return yield(0,f.createArticleTagPost)(t,o,e),n}))));e.body=a.default.success(I,M)}))}},9304:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCategoryListController=function(e){return n(this,void 0,void 0,(function*(){const t=e.query||{},{current:r,pageSize:n,isTree:i}=(0,a.parseQuery)(t);if(i){const t=yield(0,o.getArticleCategoryList)(1,0);return void(e.body=u.default.success("获取成功！",function(e){const t={},r=[];return e.forEach((e=>{t[e.articleCategoryId]=Object.assign({},e)})),e.forEach((e=>{if(0!==e.parentId){const r=t[e.parentId];r&&(r.children=r.children||[],r.children.push(t[e.articleCategoryId]))}else r.push(t[e.articleCategoryId])})),r}(t)))}const d=yield(0,o.getArticleCategoryList)(r,n);let s={};if(0===n)s=d;else{const e=yield(0,o.getArticleCategoryCount)();s={page:Number(r),pageSize:Number(n),total:e,data:d}}e.body=u.default.success("获取成功！",s)}))},t.getCategoryController=function(e){return n(this,void 0,void 0,(function*(){const{articleCategoryId:t}=e.params;if(!t)return void(e.body=u.default.error("缺少参数！"));const r=Number(t);if(isNaN(r))return void(e.body=u.default.error("参数错误！"));const n=yield(0,o.getArticleCategoryById)(r);e.body=n?u.default.success("获取成功！",n):u.default.error("分类不存在！")}))},t.saveCategory=s,t.createCategoryController=function(e){return n(this,void 0,void 0,(function*(){yield s(e,null)}))},t.updateCategoryController=function(e){return n(this,void 0,void 0,(function*(){const{articleCategoryId:t}=e.params;if(!t)return void(e.body=u.default.error("缺少参数！"));const r=Number(t);isNaN(r)?e.body=u.default.error("参数错误！"):yield s(e,r)}))},t.deleteCategoryController=function(e){return n(this,void 0,void 0,(function*(){const{articleCategoryId:t}=e.params,r=Number(t),n=yield(0,o.getArticleCategoryById)(r);if(!n)return void(e.body=u.default.error("分类不存在！"));if(yield(0,o.getArticleCategory)({parentId:n.articleCategoryId}))return void(e.body=u.default.error("存在子分类，清先删除子分类！"));const i=yield(0,o.updateArticleCategory)(r,{deletedAt:(0,d.now)()});e.body=u.default.success("删除成功！",i)}))};const o=r(874),u=i(r(8953)),a=r(1141),d=r(9590);function s(e,t){return n(this,void 0,void 0,(function*(){const{userId:r,loginName:n}=e.state.user,i=null!==t,{parentId:s=0,name:l,description:c,icon:f,order:y,status:p}=(0,a.parseJson)(e);if(!l)return void(e.body=u.default.error("分类名称不能为空！"));let m=!0;if(i){l===(yield(0,o.getArticleCategoryById)(t)).name&&(m=!1)}const h=Number(s);if(isNaN(h))return void(e.body=u.default.error("参数错误！"));if(m){if(yield(0,o.getArticleCategory)({name:l}))return void(e.body=u.default.error("分类名称已存在！"))}const v=s?`0-${s}`:"0";let g=null,_="";i?(g=yield(0,o.updateArticleCategory)(t,{parentId:s,name:l,description:c,icon:f,order:y,articleCount:0,path:v,status:p,createId:r,creator:n,updateId:r,updater:n}),_="更新成功！"):(g=yield(0,o.createArticleCategory)({parentId:s,name:l,description:c,icon:f,order:y,articleCount:0,path:v,status:p,createId:r,creator:n,updateId:r,updater:n,createdAt:(0,d.now)(),updatedAt:(0,d.now)()}),_="创建成功！"),e.body=u.default.success(_,g)}))}},5677:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{routers:t,migrate:r}=e;(0,i.default)(t),r&&r().migrateMenu(o.default)};const i=n(r(9582)),o=n(r(2087))},2087:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=[{perms:"article",menuName:"文章管理",path:"/article",children:[{perms:"article:list",menuName:"文章列表",path:"/article/list",visible:1,menuType:1},{perms:"article:view",menuName:"查看文章",path:"/article/detail/:id",visible:0,menuType:2},{perms:"article:add",menuName:"添加文章",path:"/article/add",visible:0,menuType:2},{perms:"article:edit",menuName:"编辑文章",path:"/article/edit/:id",visible:0,menuType:2},{perms:"article:delete",menuName:"删除文章",path:"/article/delete/:id",visible:0,menuType:2},{perms:"article-category",menuName:"文章分类",path:"/article/category",visible:1,menuType:1,children:[{perms:"article-category:list",menuName:"分类列表",path:"/article/category/list",visible:0,menuType:1},{perms:"article-category:view",menuName:"查看分类",path:"/article/category/detail/:id",visible:0,menuType:2},{perms:"article-category:add",menuName:"添加分类",path:"/article/category/add",visible:0,menuType:2},{perms:"article-category:edit",menuName:"编辑分类",path:"/article/category/edit/:id",visible:0,menuType:2},{perms:"article-category:delete",menuName:"删除分类",path:"/article/category/delete/:id",visible:0,menuType:2}]},{perms:"article-tag",menuName:"文章标签",path:"/article/tag",visible:1,menuType:1,children:[{perms:"article-tag:list",menuName:"标签列表",path:"/article/tag/list",visible:0,menuType:1}]}]}]},4230:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getArticleCount=function(){return n(this,arguments,void 0,(function*(e={},t=o.default){return yield t.cmsArticle.count({where:Object.assign({deletedAt:0},e)})}))},t.getArticleList=function(e,t){return n(this,arguments,void 0,(function*(e,t,r={},n=o.default){let i={};if(0!==t){i={skip:(e-1)*t,take:t}}else i={};return i.where=Object.assign({deletedAt:0},r),i.orderBy={articleId:"desc"},yield n.cmsArticle.findMany(Object.assign({},i))}))},t.getArticleById=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){const r=a+e,n=yield u.default.get(r);let i=null;return n?i=JSON.parse(n):(i=yield o.default.cmsArticle.findUnique({where:{articleId:e,deletedAt:0}}),i&&u.default.set(n,JSON.stringify(i))),i}))},t.createArticle=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){return yield t.cmsArticle.create({data:e})}))},t.updateArticle=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=o.default){const n=yield r.cmsArticle.update({where:{articleId:e},data:t});if(n){const t=a+e;u.default.del(t)}return n}))};const o=i(r(4510)),u=i(r(5687)),a="article:articleId:"},9452:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCategoryPostsByArticleId=function(e){return n(this,void 0,void 0,(function*(){return yield o.default.cmsArticleCategoryPost.findMany({where:{articleId:e},include:{articleCategory:!0}})}))},t.createArticleCategoryPost=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=o.default){return yield r.cmsArticleCategoryPost.createMany({data:t.map((t=>({articleId:e,articleCategoryId:t})))})}))},t.updateArticleCategoryPost=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=o.default){const i=yield r.cmsArticleCategoryPost.findMany({where:{articleId:e}}),u=new Set(t),a=new Set(null==i?void 0:i.map((e=>e.articleCategoryId))),d=Array.from(a).filter((e=>!u.has(e))),s=Array.from(u).filter((e=>!a.has(e)));return yield o.default.$transaction((t=>n(this,void 0,void 0,(function*(){yield t.cmsArticleCategoryPost.deleteMany({where:{articleId:e,articleCategoryId:{in:d}}}),yield t.cmsArticleCategoryPost.createMany({data:s.map((t=>({articleId:e,articleCategoryId:t})))})}))))}))},t.deleteArticleCategoryPost=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){(yield t.cmsArticleCategoryPost.findFirst({where:{articleId:e}}))&&(yield t.cmsArticleCategoryPost.deleteMany({where:{articleId:e}}))}))},t.getArticleCountByCategoryId=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){return yield t.cmsArticleCategoryPost.count({where:{articleCategoryId:e}})}))};const o=i(r(4510))},3646:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getTagPostCount=function(e){return r(this,arguments,void 0,(function*(e,t=prisma){return t.cmsArticleTagPost.count({where:{tagId:e}})}))},t.getTagListByArticleId=function(e){return r(this,arguments,void 0,(function*(e,t=prisma){return yield t.cmsArticleTagPost.findMany({where:{articleId:e}})}))},t.createArticleTagPost=function(e,t){return r(this,arguments,void 0,(function*(e,t,r=prisma){yield r.cmsArticleTagPost.deleteMany({where:{articleId:e}});const n=t.map((t=>({articleId:e,tagId:t})));return yield r.cmsArticleTagPost.createMany({data:n})}))}},874:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getArticleCategoryCount=function(){return n(this,arguments,void 0,(function*(e={},t=a.default){return t.cmsArticleCategory.count({where:Object.assign({deletedAt:0},e)})}))},t.getArticleCategoryList=s,t.getArticleCategoryTree=function(){return n(this,arguments,void 0,(function*(e={},t=a.default){const r=yield s(1,0,e,t);let n=[];return r&&(n=function(e){const t={},r=[];return e.forEach((e=>{t[e.articleCategoryId]=Object.assign({},e)})),e.forEach((e=>{if(0!==e.parentId){const r=t[e.parentId];r&&(r.children=r.children||[],r.children.push(t[e.articleCategoryId]))}else r.push(t[e.articleCategoryId])})),r}(r)),n}))},t.getArticleCategoryById=l,t.getArticleCategory=function(){return n(this,arguments,void 0,(function*(e={},t=a.default){return yield t.cmsArticleCategory.findFirst({where:Object.assign({deletedAt:0},e)})}))},t.createArticleCategory=function(e){return n(this,arguments,void 0,(function*(e,t=a.default){return yield t.cmsArticleCategory.create({data:e})}))},t.updateArticleCategory=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=a.default){const n=yield r.cmsArticleCategory.update({where:{articleCategoryId:e},data:t});if(n){const t=`${d}${e}`;o.default.del(t)}return n}))},t.getCategorysByPosts=function(e,t){return n(this,void 0,void 0,(function*(){e.category||(e.category=[]);for(let r=0;r<t.length;r++){const n=t[r],{categoryId:i}=n,o=yield l(i);e.category.push(o)}}))};const o=i(r(5687)),u=r(9974),a=i(r(4510)),d="articleCategory:articleCategoryId:";function s(e,t){return n(this,arguments,void 0,(function*(e,t,r={},n=a.default){let i={};i=0!==t?{skip:(e-1)*t,take:t}:{},i.where=Object.assign({deletedAt:0},r);return yield n.cmsArticleCategory.findMany(Object.assign({},i))}))}function l(e){return n(this,arguments,void 0,(function*(e,t=a.default){const r=`${d}${e}`,n=yield o.default.get(r);let i=null;return n?i=JSON.parse(n):(i=yield t.cmsArticleCategory.findUnique({where:{articleCategoryId:e,deletedAt:0}}),i&&o.default.set(r,(0,u.serializeData)(i))),i}))}},7500:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getTagCount=function(){return n(this,arguments,void 0,(function*(e={},t=o.default){return yield t.cmsArticleTag.count({where:Object.assign(Object.assign({},e),{deletedAt:0})})}))},t.getTagList=function(e,t){return n(this,arguments,void 0,(function*(e,t,r={},n={id:"desc"},i=o.default){let u={};if(0!==t){const r=(e-1)*t;u.skip=r,u.take=t}return u.where=Object.assign({},r),u.orderBy=n,yield i.cmsArticleTag.findMany(Object.assign({},u))}))},t.getTagById=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){const r=a+e,n=yield u.default.get(r);let i=null;return n?i=JSON.parse(n):(i=yield t.cmsArticleTag.findUnique({where:{id:e}}),i&&(yield u.default.set(r,JSON.stringify(i)))),i}))},t.getTagByQuery=function(){return n(this,arguments,void 0,(function*(e={},t=o.default){return t.cmsArticleTag.findFirst({where:e})}))},t.createTag=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){return yield t.cmsArticleTag.create({data:e})}))},t.updateTag=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=o.default){const n=yield r.cmsArticleTag.update({where:{id:e},data:t});if(n){const t=a+e;yield u.default.del(t)}return n}))};const o=i(r(4510)),u=i(r(5687)),a="tag:tagId:"},4236:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.get("/article-categories",n.getCategoryListController),e.get("/article-categories/:articleCategoryId",n.getCategoryController),e.post("/article-categories",n.createCategoryController),e.put("/article-categories/:articleCategoryId",n.updateCategoryController),e.delete("/article-categories/:articleCategoryId",n.deleteCategoryController),e.get("/articles",i.getArticleListController),e.get("/articles/:articleId",i.getArticleController),e.post("/articles",i.createArticleController),e.put("/articles/:articleId",i.updateArticleController),e.delete("/articles/:articleId",i.deleteArticleController)};const n=r(9304),i=r(9264)},9582:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{adminRouter:t,apiRouter:r}=e;(0,i.default)(t),(0,o.default)(r)};const i=n(r(4236)),o=n(r(5601))},5601:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.get("/article-categories",n.getCategoryListController),e.get("/articles",i.getArticleListController),e.get("/articles/:articleId",i.getArticleController)};const n=r(9304),i=r(9264)},4493:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createTagService=function(e){return n(this,arguments,void 0,(function*(e,t=prisma){const r=yield(0,o.getTagByQuery)({name:e},t);let n=null;if(r){const e=r.id,u=yield(0,i.getTagPostCount)(e,t);n=yield(0,o.updateTag)(e,{articleCount:u},t)}else n=yield(0,o.createTag)({name:e,articleCount:1},t);return n}))};const i=r(3646),o=r(7500)},6451:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getEnforcer=function(){return n(this,void 0,void 0,(function*(){const e=yield u.PrismaAdapter.newAdapter();return d||(d=yield(0,o.newEnforcer)(a.default.join(global.ROOT_PATH,"config/casbin/rbac_model.conf"),e)),d}))};const o=r(4166),u=r(1367),a=i(r(6928));let d},3278:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwtRefreshSecretExpire=t.jwtRefreshSecret=t.jwtSecretExpire=t.jwtSecret=void 0,t.jwtSecret=process.env.JWT_SECRET||"nextcms",t.jwtSecretExpire=process.env.JWT_SECRET_EXPIRE||"1d",t.jwtRefreshSecret=process.env.JWT_REFRESH_SECRET||"nextcms",t.jwtRefreshSecretExpire=process.env.JWT_REFRESH_SECRET_EXPIRE||"7d"},398:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.adminPrefix=t.prefix=void 0,t.prefix="/api/v1",t.adminPrefix="/admin"},1546:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getApisController=void 0;const o=r(4180),u=i(r(8953));t.getApisController=e=>n(void 0,void 0,void 0,(function*(){const t=yield(0,o.getApis)();e.body=u.default.success("获取成功！",t)}))},502:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.home=void 0;t.home=e=>{const t=e.state.user;e.body={msg:"hello admin",code:1,data:t}}},9703:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteMenuController=t.updateMenuController=t.addMenuController=t.getMenuController=t.getMenusController=void 0;const o=r(6451),u=i(r(8953)),a=r(361),d=i(r(4510)),s=r(6057);t.getMenusController=e=>n(void 0,void 0,void 0,(function*(){const{userId:t}=e.state.user,r=e.state.admin,n=yield(0,o.getEnforcer)();let i=[];if(!0===r)i=yield(0,a.getMenus)();else{const e=(yield n.getPermissionsForUser(`${t}`)).map((e=>Number(e[1])));i=yield(0,a.getMenus)({menuId:{in:e}})}const d=function(e){const t={},r=[];return e.forEach((e=>{if(e.menuId){const r=e.menuId;t[r]=Object.assign({},e)}})),e.forEach((e=>{const n=t[e.parentId];n?(n.children||(n.children=[]),n.children.push(t[e.menuId])):r.push(t[e.menuId])})),r}(i);e.body=u.default.success("获取成功！",d)}));t.getMenuController=e=>n(void 0,void 0,void 0,(function*(){const{menuId:t}=e.params;if(!t)return void(e.body=u.default.error("参数错误！"));const r=Number(t);if(isNaN(r))return void(e.body=u.default.error("参数错误！"));const n=yield(0,a.getMenuById)(r);if(!n)return void(e.body=u.default.error("菜单不存在！"));const i=yield(0,s.getMenuApiList)({menuId:r});n.apis=i.map((e=>e.apiId)),e.body=u.default.success("获取成功！",n)}));const l=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=void 0){const{menuName:r,path:i,icon:o,parentId:l=0,sortOrder:c=1,component:f,query:y,isFrame:p=0,isCache:m=0,menuType:h=0,visible:v=1,status:g=1,perms:_,createdId:b,createdBy:w="",updatedId:A,updatedBy:I="",remark:M="",apis:C=[]}=e.request.body;if(r)try{const P={menuName:r,path:i,icon:o,parentId:l,sortOrder:c,component:f,query:y,isFrame:p,isCache:m,menuType:h,visible:v,status:g,perms:_,createdId:b,createdBy:w,updatedId:A,updatedBy:I,remark:M};let N;try{N=yield d.default.$transaction((e=>n(void 0,void 0,void 0,(function*(){let r,n=[];if(t){if(r=yield(0,a.updateMenu)(t,P,e),n=yield(0,s.getMenuApiList)({menuId:t},e),!C||0===(null==C?void 0:C.length))return yield(0,s.deleteMenuApiByQuery)({menuId:t},e),r}else r=yield(0,a.createMenu)(P,e),t=r.menuId;if(0===n.length){const t=[];for(const e of C)t.push({menuId:r.menuId,apiId:Number(e)});return yield(0,s.createMenuApis)(t,e),r}const i=C.filter((e=>!n.some((t=>t.apiId===e))));if(i.length>0){const t=[];for(const e of i)t.push({menuId:r.menuId,apiId:e});yield(0,s.createMenuApis)(t,e)}const o=n.filter((e=>!C.some((t=>e.apiId===t))));if(o.length>0){const r=[];for(const e of o)r.push(e.apiId);yield(0,s.deleteMenuApiByQuery)({menuId:t,apiId:{in:r}},e)}return r}))))}catch(t){e.body=u.default.error("操作失败！",t)}if(!N)return void(e.body=u.default.error("操作失败！"));e.body=u.default.success("操作成功！",N)}catch(t){e.body=u.default.error("操作失败！",t)}else e.body=u.default.error("菜单名称不能为空！")}));t.addMenuController=e=>n(void 0,void 0,void 0,(function*(){yield l(e)}));t.updateMenuController=e=>n(void 0,void 0,void 0,(function*(){const{menuId:t}=e.params,r=Number(t);isNaN(r)?e.body=u.default.error("参数错误！"):yield l(e,r)}));t.deleteMenuController=e=>n(void 0,void 0,void 0,(function*(){const{id:t}=e.params;if(!t)return void(e.body=u.default.error("参数错误！"));const r=Number(t);if(isNaN(r))e.body=u.default.error("参数错误！");else try{if(!(yield(0,a.deleteMenu)(r)))return void(e.body=u.default.error("菜单不存在！"));e.body=u.default.success("删除成功！")}catch(t){e.body=u.default.error("删除失败！")}}))},8300:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getRolesController=function(e){return n(this,void 0,void 0,(function*(){const t=e.query||{},{current:r="1",pageSize:n="10",name:i="",description:u="",status:s=""}=t,l={};i&&(l.name={contains:i}),u&&(l.description={contains:u}),s&&(l.status=Number(s));const c=yield(0,d.getRoleList)(Number(r),Number(n),l);(0,o.formatFields)(c,[{fromField:"createdAt",toField:"createdTime"},{fromField:"updatedAt",toField:"updatedTime"}]);let f={};if("0"===n)f=c;else{const e=yield(0,d.getRoleCount)();f={page:Number(r),pageSize:Number(n),total:e,data:c}}e.body=a.default.success("获取成功！",f)}))},t.getRoleController=function(e){return n(this,void 0,void 0,(function*(){const{roleId:t}=e.params,r=Number(t);if(isNaN(r))e.body=a.default.error("参数错误！");else{if(r>0){const n=yield(0,d.getRoleById)(r),i=[],o=yield(0,l.getEnforcer)();return(yield o.getFilteredPolicy(0,t)).forEach((e=>{i.push(Number(e[1]))})),n.menuIds=i,n?void(e.body=a.default.success("获取成功！",n)):void(e.body=a.default.error("角色不存在！"))}e.body=a.default.error("参数错误！")}}))},t.addRoleController=function(e){return n(this,void 0,void 0,(function*(){return c(e,null)}))},t.updateRoleController=function(e){return n(this,void 0,void 0,(function*(){const{roleId:t}=e.params,r=Number(t);if(!isNaN(r))return c(e,r);e.body=a.default.error("参数错误！")}))},t.deleteRoleController=function(e){return n(this,void 0,void 0,(function*(){const{roleId:t}=e.params,r=Number(t);if(isNaN(r))e.body=a.default.error("参数错误！");else{if(r>0){if(!(yield(0,d.getRoleById)(r)))return void(e.body=a.default.error("角色不存在！"));const n=yield(0,d.deleteRole)(r);return n&&s.default.del(`role:${t}`),void(e.body=a.default.success("删除成功！",n))}e.body=a.default.error("参数错误！")}}))};const o=r(9590),u=r(1141),a=i(r(8953)),d=r(5306),s=i(r(5687)),l=r(6451);function c(e,t){return n(this,void 0,void 0,(function*(){const r=null!==t,{name:n,description:i,sortOrder:c,status:f,menuIds:y=[]}=(0,u.parseJson)(e);if(!n)return void(e.body=a.default.error("角色名称不能为空！"));const p=yield(0,d.getRoleByName)(n);if(p){if(!r)return void(e.body=a.default.error("角色名称已存在！"));if(p.roleId!==t)return void(e.body=a.default.error("角色名称已存在！"))}let m=null,h="";try{if(r?(m=yield(0,d.updateRole)(t,{name:n,description:i,sortOrder:c,status:f,updatedAt:(0,o.now)()}),h="修改成功！"):(m=yield(0,d.createRole)({name:n,description:i,sortOrder:c,status:f,createdAt:(0,o.now)(),updatedAt:(0,o.now)()}),h="新增成功！"),m){const e=yield(0,l.getEnforcer)();for(const r of y)e.addPermissionForUser(`${t}`,`${r}`);yield e.savePolicy(),r&&s.default.del(`role:${t}`)}e.body=a.default.success(h,m)}catch(t){return void(e.body=a.default.error("系统出错！"))}}))}},6767:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteUserController=t.updateUserController=t.addUserController=t.getUserController=t.getUsersController=void 0;const u=r(6451),a=r(9590),d=o(r(8953)),s=r(9974),l=r(7685);t.getUsersController=e=>n(void 0,void 0,void 0,(function*(){const t=e.query||{},{current:r="1",pageSize:n="10",loginName:i="",phone:o="",status:u}=t,s={userType:1};i&&(s.loginName={contains:i}),o&&(s.phone={contains:o}),u&&(s.status=Number(u));const c=yield(0,l.getUserList)(Number(r),Number(n),s);(0,a.formatFields)(c,[{fromField:"loginAt",toField:"loginTime"},{fromField:"createdAt",toField:"createTime"},{fromField:"updatedAt",toField:"updateTime"}]);const f=c.map((e=>{const t=Object.assign({},e);return delete t.password,t}));let y={};if("0"===n)y=f;else{const e=yield(0,l.getUserCount)(s);y={page:Number(r),pageSize:Number(n),total:e,data:f}}e.body=d.default.success("获取成功！",y)}));t.getUserController=e=>n(void 0,void 0,void 0,(function*(){const{userId:t}=e.params;if(!t)return void(e.body=d.default.error("参数错误！"));const r=yield(0,l.getUserById)(Number(t));if(!r)return void(e.body=d.default.error("用户不存在！"));const{password:n}=r,o=i(r,["password"]),a=yield(0,u.getEnforcer)(),s=yield a.getRolesForUser(`${r.userId}`);o.roleIds=s.map((e=>Number(e))),e.body=d.default.success("获取成功！",o)}));t.addUserController=e=>n(void 0,void 0,void 0,(function*(){return c(e,null)}));t.updateUserController=e=>n(void 0,void 0,void 0,(function*(){const{userId:t}=e.params;return c(e,t)}));const c=(e,t)=>n(void 0,void 0,void 0,(function*(){const{loginName:r,email:n,phone:i,nickname:o,realname:c,password:f,gender:y,birthday:p,avatar:m,loginIp:h,loginTime:v,status:g,remark:_,roleIds:b}=e.request.body;if(!r)return void(e.body=d.default.error("登录用户名不能为空！"));const w=yield(0,l.getUser)({loginName:r});if(w){if(null===t)return void(e.body=d.default.error("登录用户名已存在！"));if(w.userId!==Number(t))return void(e.body=d.default.error("登录用户名已存在！"))}if(null===t&&!f)return void(e.body=d.default.error("密码不能为空！"));if(i){const r=yield(0,l.getUser)({phone:i});if(r){if(null===t)return void(e.body=d.default.error("手机号已存在！"));if(r.userId!==Number(t))return void(e.body=d.default.error("手机号已存在！"))}}if(n){const r=yield(0,l.getUser)({email:n});if(r){if(null===t)return void(e.body=d.default.error("邮箱已存在！"));if(r.userId!==Number(t))return void(e.body=d.default.error("邮箱已存在！"))}}const A=(0,s.generateSalt)(),I=yield(0,s.hashPassword)(f+A);if(null!==t){const r=yield(0,l.getUserById)(Number(t));if(!r)return void(e.body=d.default.error("用户不存在！"));let n=r.salt,i=r.password;f||(n=(0,s.generateSalt)(),i=yield(0,s.hashPassword)(f+n))}const M={loginName:r,email:n,phone:i&&`${i}`,nickname:o,realname:c,password:I,salt:A,gender:y,birthday:p,userType:1,avatar:m,loginIp:h,loginTime:v,status:g,remark:_,createdAt:(0,a.now)(),updatedAt:(0,a.now)()};let C=null,P="";if(null!==t?(C=yield(0,l.updateUser)(Number(t),M),P="修改成功！"):(C=yield(0,l.createUser)(M),P="添加成功！"),b){const e=yield(0,u.getEnforcer)();for(const t of b)e.addRoleForUser(`${C.userId}`,`${t}`);yield e.savePolicy()}e.body=d.default.success(P,C)}));t.deleteUserController=e=>n(void 0,void 0,void 0,(function*(){const{userId:t}=e.params;if(!t)return void(e.body=d.default.error("参数错误！"));const r=Number(t);if(isNaN(r))return void(e.body=d.default.error("参数错误！"));if(!(yield(0,l.getUserById)(r)))return void(e.body=d.default.error("用户不存在！"));const n=yield(0,l.deleteUser)(r);e.body=d.default.success("删除成功！",n)}))},3667:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Login=void 0;const o=i(r(829)),u=i(r(5486)),a=i(r(8953)),d=r(7685),s=r(1141),l=r(9672),c=r(9590),f=r(3278),y={email:"邮箱",phone:"手机号",account:"账号"};t.Login=e=>n(void 0,void 0,void 0,(function*(){const{account:t,password:r,loginType:n="account",phoneType:i}=(0,s.parseJson)(e);if(!t)return void(e.body=a.default.error(`${y[n]}不能为空`));let p=null;switch(n){case"email":p=yield(0,d.getUser)({email:t});break;case"phone":p=yield(0,d.getUser)({phone:t});break;case"account":p=yield(0,d.getUser)({loginName:t})}if(!p)return void(e.body=a.default.error("用户不存在"));if("phone"===n&&"sms"===i)return;if(!r)return void(e.body=a.default.error("密码不能为空"));if(!(null==p?void 0:p.password))return void(e.body=a.default.error("密码错误"));{const t=r+p.salt;if(!(yield u.default.compare(t,p.password)))return void(e.body=a.default.error("密码错误"))}const{userId:m}=p,h=f.jwtSecretExpire,v=o.default.sign({userId:m},f.jwtSecret,{expiresIn:h}),g=f.jwtRefreshSecretExpire,_=o.default.sign({userId:m},f.jwtRefreshSecret,{expiresIn:g}),b=(0,c.calculateExpiresAt)(h),w=(0,c.calculateExpiresAt)(g);(yield(0,l.createUserToken)({userId:m,accessToken:v,refreshToken:_,expiresAt:b,reExpiresAt:w}))?e.body=a.default.success("登录成功！",{accessToken:v,expiresAt:b,refreshToken:_,reExpiresAt:w}):e.body=a.default.error("登录失败")}))},8835:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.currentUser=void 0;const u=o(r(829)),a=o(r(8953)),d=r(7685),s=r(3278);t.currentUser=e=>n(void 0,void 0,void 0,(function*(){const t=e.headers.authorization;if(!t)return e.status=401,void(e.body=a.default.error("非法访问"));try{const r=u.default.verify(t.split(" ")[1],s.jwtSecret).userId,n=yield(0,d.getUserById)(Number(r));if(!n)return void(e.body=a.default.error("用户不存在"));const{password:o,salt:l}=n,c=i(n,["password","salt"]);e.body=a.default.success("获取成功！",c)}catch(t){let r="";t instanceof Error&&(r=t.message),e.body=a.default.error(r,t,!0)}}))},1977:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return n(this,void 0,void 0,(function*(){const{userId:r}=e.state.user,n=yield(0,i.getEnforcer)(),a=yield n.getUsersForRole(`${r}`);if(1===r||a.includes("1"))return e.state.admin=!0,void(yield t());const{url:d,method:s}=e.request,l=d.split("?")[0],c=yield(0,o.getApiByMethodAndPath)(s,l);if(c){const t=yield(0,u.getMenuApiByQuery)({apiId:c.id});let i=[];for(const e of t)i.push(e.menuId.toString());if(!(yield n.hasPermissionForUser(r,...i)))return e.status=403,void(e.body={code:403,message:"没有权限访问该接口"})}yield t()}))};const i=r(6451),o=r(4180),u=r(6057)},4049:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.auth=void 0;const u=o(r(829)),a=o(r(8953)),d=r(7685),s=r(3278);t.auth=(e,t)=>n(void 0,void 0,void 0,(function*(){const r=e.headers.authorization;if(!r)return e.status=401,void(e.body=a.default.error("用户登录已失效"));try{const n=u.default.verify(r.split(" ")[1],s.jwtSecret).userId,o=yield(0,d.getUserById)(Number(n));if(!o)return e.status=401,void(e.body=a.default.error("用户不存在"));const{password:l}=o,c=i(o,["password"]);e.state.user=c,yield t()}catch(t){console.log(t),e.status=500,e.body=a.default.error(t.message,t)}}))},9539:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(4180),u=r(398),a=i(r(2411));t.default=()=>n(void 0,void 0,void 0,(function*(){const e=a.default.stack.filter((e=>e.methods.length>0)).filter((e=>e.path&&""!==e.path.trim())).flatMap((e=>e.methods.map((t=>({method:t,path:e.path}))))).filter((e=>!1===e.method.includes("HEAD"))).filter((e=>e.path.includes(u.prefix+u.adminPrefix+"/")));for(const t of e){const e=t.method.toLowerCase(),r=t.path,n=yield(0,o.getApiByMethodAndPath)(e,r);n?(0,o.updateApi)(n.id,{method:e,path:r}):(0,o.createApi)({method:e,path:r})}}))},5579:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n(this,void 0,void 0,(function*(){const{menus:t}=e;(0,o.default)(),(0,a.default)(),(0,u.default)(t),(0,d.default)()}))};const o=i(r(9560)),u=i(r(3528)),a=i(r(4767)),d=i(r(9539))},3528:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n(this,void 0,void 0,(function*(){d(e)}))};const i=r(361),o=r(9590),u=r(4180),a=r(6057);function d(e){return n(this,arguments,void 0,(function*(e,t=0){for(const r of e){let e=r.menuType||0;e=Number(e);const n=yield(0,i.getMenuByName)(r.menuName);let s;s=(null==n?void 0:n.menuId)?yield(0,i.updateMenu)(n.menuId,{menuName:r.menuName,parentId:t,menuType:e,path:r.path,perms:r.perms,icon:"",sortOrder:0,updatedId:1,updatedBy:"admin",visible:0==(null==r?void 0:r.visible)?0:1,status:0==(null==r?void 0:r.status)?0:1,createdAt:(0,o.now)(),updatedAt:(0,o.now)()}):yield(0,i.createMenu)({menuName:r.menuName,parentId:t,menuType:e,path:r.path,perms:r.perms,icon:"",sortOrder:0,visible:0==(null==r?void 0:r.visible)?0:1,status:0==(null==r?void 0:r.status)?0:1,createdId:1,createdBy:"admin",updatedId:1,updatedBy:"admin",updatedAt:(0,o.now)()});const l=r.apis||[];let c=[];for(const e of l){let t=null;const r=yield(0,u.getApiByMethodAndPath)(e.method,e.path);if(t=r?yield(0,u.updateApi)(r.id,{path:e.path,method:e.method,description:e.description,group:e.group}):yield(0,u.createApi)({path:e.path,method:e.method,description:e.description,group:e.group}),t){(yield(0,a.getMenuApiByMenuIdAndApiId)(s.menuId,t.id))||c.push({menuId:s.menuId,apiId:t.id})}}if(c.length>0&&(yield(0,a.createMenuApis)(c)),r.children&&r.children.length>0){const e=s.menuId;yield d(r.children,e)}}}))}},4767:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return n(this,void 0,void 0,(function*(){(yield(0,a.getRoleById)(1))||(yield(0,a.createRole)({name:"超级管理员",description:"超级管理员",createdAt:(0,o.now)(),updatedAt:(0,o.now)()}));const e=d.default.join(global.ROOT_PATH,"config/migrate/menus.json"),t=(0,u.getFileJson)(e);for(const e of t){const t=yield(0,a.getRoleByName)(e.name);t?yield(0,a.updateRole)(t.roleId,{name:e.name,description:e.description,createdAt:(0,o.now)(),updatedAt:(0,o.now)()}):yield(0,a.createRole)({name:e.name,description:e.description,createdAt:(0,o.now)(),updatedAt:(0,o.now)()})}}))};const o=r(9590),u=r(412),a=r(5306),d=i(r(6928))},9560:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return n(this,void 0,void 0,(function*(){if(!(yield o.default.sysUser.findFirst({where:{loginName:"admin"}}))){const e=(0,a.generateSalt)(),t=yield(0,a.hashPassword)("123456"+e);yield o.default.sysUser.create({data:{loginName:"admin",password:t,salt:e,nickname:"admin",userType:1,status:1,createdAt:(0,u.now)(),updatedAt:(0,u.now)()}})}}))};const o=i(r(4510)),u=r(9590),a=r(9974)},4180:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getApis=function(){return n(this,arguments,void 0,(function*(e={},t=o.default){return yield t.sysApi.findMany({where:e})}))},t.getApiById=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){const r=`${d}${e}`,n=yield u.default.get(r);if(n)return JSON.parse(n);const i=yield t.sysApi.findUnique({where:{id:e}});return i&&u.default.set(r,(0,a.serializeData)(i)),i}))},t.getApiByMethodAndPath=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=o.default){return yield r.sysApi.findUnique({where:{path_method:{method:e,path:t}}})}))},t.createApi=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){return yield t.sysApi.create({data:e})}))},t.updateApi=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=o.default){return yield r.sysApi.update({where:{id:e},data:t})}))},t.createApis=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){return yield t.sysApi.createMany({data:e})}))};const o=i(r(4510)),u=i(r(5687)),a=r(9974),d="api:id:"},361:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteMenu=t.updateMenu=t.createMenu=t.getMenuByName=t.getMenuById=t.getMenus=void 0;const o=i(r(4510)),u=i(r(5687)),a=r(9974),d="menu:id:";t.getMenus=(...e)=>n(void 0,[...e],void 0,(function*(e={},t=o.default){return yield t.sysMenu.findMany({where:e})}));t.getMenuById=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=o.default){const r=`${d}${e}`,n=yield u.default.get(r);if(n)return JSON.parse(n);const i=yield t.sysMenu.findUnique({where:{menuId:e}});return i&&u.default.set(r,(0,a.serializeData)(i)),i}));t.getMenuByName=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=o.default){return yield t.sysMenu.findFirst({where:{menuName:e}})}));t.createMenu=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=o.default){return yield t.sysMenu.create({data:e})}));t.updateMenu=(e,t,...r)=>n(void 0,[e,t,...r],void 0,(function*(e,t,r=o.default){const n=yield r.sysMenu.update({where:{menuId:e},data:t});return n&&(yield u.default.del(`${d}${e}`)),n}));t.deleteMenu=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=o.default){const r=yield t.sysMenu.delete({where:{menuId:e}});if(r){const t=`${d}${e}`;u.default.del(t)}return r}))},6057:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getMenuApiList=function(){return n(this,arguments,void 0,(function*(e={},t=o.default){return yield t.sysMenuApi.findMany({where:e})}))},t.getMenuApiByMenuIdAndApiId=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=o.default){const n=`${e}-${t}`,i=yield u.default.get(n);if(i)return JSON.parse(i);const d=yield r.sysMenuApi.findUnique({where:{menuId_apiId:{menuId:e,apiId:t}}});return d&&(yield u.default.set(n,(0,a.serializeData)(d))),d}))},t.getMenuApiByQuery=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){return yield t.sysMenuApi.findMany({where:e})}))},t.createMenuApis=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){return yield t.sysMenuApi.createMany({data:e})}))},t.updateMenuApi=function(e,t,r){return n(this,arguments,void 0,(function*(e,t,r,n=o.default){return yield n.sysMenuApi.update({where:{menuId_apiId:{menuId:e,apiId:t}},data:r})}))},t.deleteMenuApi=function(e,t){return n(this,arguments,void 0,(function*(e,t,r=o.default){return yield r.sysMenuApi.delete({where:{menuId_apiId:{menuId:e,apiId:t}}})}))},t.deleteMenuApiByQuery=function(e){return n(this,arguments,void 0,(function*(e,t=o.default){return yield t.sysMenuApi.deleteMany({where:e})}))};const o=i(r(4510)),u=i(r(5687)),a=r(9974)},5306:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteRole=t.updateRole=t.createRole=t.getRoleCount=t.getRoleByName=t.getRoleById=t.getRoleList=void 0;const o=r(9590),u=i(r(4510)),a=i(r(5687)),d=r(9974),s="role:id:";t.getRoleList=(...e)=>n(void 0,[...e],void 0,(function*(e=1,t,r={},n=u.default){const i=0===t?{}:{skip:(e-1)*t,take:t};i.where=Object.assign(Object.assign({},r),{deletedAt:0});const a=yield n.sysRole.findMany(Object.assign({},i));return(0,o.formatFields)(a,[{fromField:"createdAt",toField:"createTime"},{fromField:"updatedAt",toField:"updateTime"}]),a}));t.getRoleById=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=u.default){const r=yield a.default.get(`${s}${e}`);if(r)return JSON.parse(r);const n=yield t.sysRole.findUnique({where:{roleId:e,deletedAt:0}});return n&&a.default.set(`${s}${e}`,(0,d.serializeData)(n)),n}));t.getRoleByName=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=u.default){return yield t.sysRole.findFirst({where:{name:e,deletedAt:0}})}));t.getRoleCount=(...e)=>n(void 0,[...e],void 0,(function*(e=u.default){return yield e.sysRole.count({where:{deletedAt:0}})}));t.createRole=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=u.default){return yield t.sysRole.create({data:e})}));t.updateRole=(e,t,...r)=>n(void 0,[e,t,...r],void 0,(function*(e,t,r=u.default){const n=yield r.sysRole.update({where:{roleId:e},data:t});return n&&a.default.del(`${s}${e}`),n}));t.deleteRole=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=u.default){return yield t.sysRole.update({where:{roleId:e},data:{deletedAt:(0,o.now)()}})}))},7685:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteUser=t.updateUser=t.createUser=t.getUser=t.getUserList=t.getUserCount=t.getUserById=void 0;const o=r(9590),u=i(r(4510)),a=i(r(5687)),d=r(9974),s="user:id:";t.getUserById=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=u.default){const r=yield a.default.get(`${s}${e}`);let n=null;return r&&(n=JSON.parse(r)),n||(n=yield t.sysUser.findUnique({where:{userId:e,deletedAt:0}}),n&&a.default.set(`${s}${{userId:e}}`,(0,d.serializeData)(n))),n}));t.getUserCount=(...e)=>n(void 0,[...e],void 0,(function*(e={},t=u.default){return yield t.sysUser.count({where:Object.assign(Object.assign({},e),{deletedAt:0})})}));t.getUserList=(...e)=>n(void 0,[...e],void 0,(function*(e=1,t,r={},n=u.default){const i=0===t?{}:{skip:(e-1)*t,take:t};i.where=Object.assign(Object.assign({},r),{deletedAt:0});return yield n.sysUser.findMany(Object.assign({},i))}));t.getUser=(e,t=u.default)=>t.sysUser.findUnique({where:e});t.createUser=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=u.default){return yield t.sysUser.create({data:e})}));t.updateUser=(e,t,...r)=>n(void 0,[e,t,...r],void 0,(function*(e,t,r=u.default){const n=yield r.sysUser.update({where:{userId:e},data:t});return n&&a.default.del(`${s}:${e}`),n}));t.deleteUser=(e,...t)=>n(void 0,[e,...t],void 0,(function*(e,t=u.default){const r=yield t.sysUser.update({where:{userId:e},data:{deletedAt:(0,o.now)()}});return r&&a.default.del(`${s}:${e}`),r}))},9672:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createUserToken=void 0;const i=n(r(4510));t.createUserToken=(e,t=i.default)=>t.sysUserToken.create({data:e})},8548:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(4733)),o=r(4049),u=r(502),a=r(8300),d=r(6767),s=r(9703),l=r(1546),c=r(398),f=n(r(1977)),y=new i.default({prefix:c.adminPrefix});y.use(o.auth,f.default),y.get("/",u.home),y.get("/roles",a.getRolesController),y.get("/roles/:roleId",a.getRoleController),y.post("/roles",a.addRoleController),y.put("/roles/:roleId",a.updateRoleController),y.delete("/roles/:roleId",a.deleteRoleController),y.get("/users",d.getUsersController),y.get("/users/:userId",d.getUserController),y.post("/users",d.addUserController),y.put("/users/:userId",d.updateUserController),y.delete("/users/:userId",d.deleteUserController),y.get("/menus",s.getMenusController),y.get("/menus/:menuId",s.getMenuController),y.post("/menus",s.addMenuController),y.put("/menus/:menuId",s.updateMenuController),y.delete("/menus/:menuId",s.deleteMenuController),y.get("/apis",l.getApisController),t.default=y},2411:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.routers=void 0,t.registerRoutes=function(){const{adminRouter:e,apiRouter:t}=a.routers;return t.post("/login",o.Login),t.get("/currentUser",u.currentUser),t.use(e.routes()),d.use(t.routes()),d};const i=n(r(4733)),o=r(3667),u=r(8835),a=r(5350);Object.defineProperty(t,"routers",{enumerable:!0,get:function(){return a.routers}});let d=new i.default;t.default=d},5350:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.routers=void 0;const i=n(r(4733)),o=n(r(8548)),u=r(398),a=new i.default({prefix:u.prefix}),d={adminRouter:o.default,apiRouter:a};t.routers=d},8156:function(e,t,r){var n,i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),u=0;u<r.length;u++)"default"!==r[u]&&i(t,e,r[u]);return o(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(4469);const d=a(r(6101)),s=r(1665),l=a(r(8216)),c=u(r(2411)),f=a(r(8056)),y=r(6483),p=a(r(5307));global.ROOT_PATH=__dirname;const m={router:null,routers:c.routers,migrate:null};(0,y.install)(m),(0,p.default)(m),(0,c.registerRoutes)(),m.migrate&&m.migrate().commit();const h=new d.default;h.use((0,l.default)());const v=process.env.PORT||3e3;h.use(c.default.routes()),h.use(f.default.routes()),h.use((0,s.koaSwagger)({routePrefix:"/swagger",swaggerOptions:{url:"/swagger.json"}})),h.listen(v,(()=>{console.log(`🚀 Server is running on port http://localhost:${v}/`)}))},9590:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.now=function(){return Math.floor((new Date).getTime()/1e3)},t.formatFields=function(e,t){e.forEach((e=>{t.forEach((t=>{const{fromField:r,toField:n,format:o="YYYY-MM-DD HH:mm:ss"}=t;e[r]&&(e[n]=i.default.unix(Number(e[r])).format(o))}))}))},t.formatField=function(e,t){t.forEach((t=>{const{fromField:r,toField:n,format:o="YYYY-MM-DD HH:mm:ss"}=t;e[r]&&(e[n]=i.default.unix(Number(e[r])).format(o))}))},t.calculateExpiresAt=function(e){const t=e.match(/(\d+)([a-zA-Z]+)/);if(!t)throw new Error("Invalid jwtExpire format");const r=parseInt(t[1],10),n=t[2];return(0,i.default)().add(r,n).unix()};const i=n(r(6293))},412:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFileJson=function(e){try{const t=i.default.readFileSync(e,"utf8");return JSON.parse(t)}catch(e){return[]}};const i=n(r(9896))},959:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.compressHTML=function(e){return e=(e=(e=(e=(0,i.default)(e,{allowedTags:["p","strong","em","span","a","br","ul","ol","li","h1","h2","h3","h4","h5","h6","blockquote","pre","code","img","div"],allowedAttributes:{a:["href","target","rel"],img:["src","alt","width","height"],code:["spellcheck"],"*":["class","style","data-*"]},allowedSchemes:["http","https","mailto"],allowedSchemesByTag:{img:["data"]},allowProtocolRelative:!0})).replace(/\s+/g," ")).replace(/>\s+</g,"><")).trim()};const i=n(r(2583))},6483:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.install=void 0;const i=n(r(9896)),o=n(r(6928)),u=n(r(7622));t.install=e=>{const t=o.default.resolve(global.ROOT_PATH,"install"),r=o.default.resolve(t,"install.lock");return i.default.existsSync(r)?(console.log("已经安装过"),!0):(e.migrate=u.default,i.default.existsSync(t)||i.default.mkdirSync(t),i.default.writeFileSync(r,""),!1)}},4510:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6330),i=global.prisma||new n.PrismaClient;t.default=i},5687:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(7659),{REDIS_URL:i}=process.env;let o=null;i&&(o=new n.Redis(i));t.default={get:e=>{if(!o)return null;const t=process.env.APP_NAME||"nextcms";return o.get(t+":"+e)},set:(e,t)=>{if(!o)return null;const r=process.env.APP_NAME||"nextcms";return o.set(r+":"+e,t)},del:e=>{if(!o)return null;const t=process.env.APP_NAME||"nextcms";return o.del(t+":"+e)}}},1141:function(e,t){var r=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.parseQuery=t.parseJson=void 0;t.parseJson=e=>e.request.body||{};t.parseQuery=e=>{const{current:t,pageSize:n}=e,i=r(e,["current","pageSize"]);return Object.assign({current:null!=t?Number(t):1,pageSize:null!=n?Number(n):10},i)}},8953:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const r={code:1,msg:"",data:null};const n={success:function(e,t=null){return r.code=1,r.msg=e,r.data=t,r},error:function(e,t=null,n=!1){return r.code=0,r.msg=e,r.data=t,r},errorWithCode:function(e,t,n=null){return r.code=e,r.msg=t,r.data=n,r}};t.default=n},9974:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.excludeFields=function(e,t){return Object.fromEntries(Object.entries(e).filter((([e])=>!t.includes(e))))},t.serializeData=function(e){return JSON.stringify(e,((e,t)=>{"bigint"==typeof t&&t.toString()}))},t.generateSalt=function(e=6){return u.default.randomBytes(e).toString("hex").slice(0,e)},t.hashPassword=function(e){return n(this,void 0,void 0,(function*(){const t=yield o.default.genSalt(10);return o.default.hash(e,t)}))};const o=i(r(5486)),u=i(r(6982))},7622:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.commit=u;const i=r(5543),o=n(r(5579));function u(){(0,o.default)({menus:i.systemMenus})}t.default=function(e={}){const{menus:t}=e;return t&&(0,i.migrateMenu)(t),{migrateMenu:i.migrateMenu,commit:u}}},5543:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.migrateMenu=t.systemMenus=void 0,t.systemMenus=[{perms:"user",menuName:"管理员",path:"/user",children:[{perms:"user:admin",menuName:"管理员管理",path:"/user/admin",children:[{perms:"user:admin:list",menuName:"管理员列表",path:"/user/admin/list",visible:0,menuType:1},{perms:"user:admin:add",menuName:"添加管理员",path:"/user/admin/add",visible:0,menuType:2},{perms:"user:admin:edit",menuName:"编辑管理员",path:"/user/admin/edit/:id",visible:0,menuType:2},{perms:"user:admin:delete",menuName:"删除管理员",path:"/user/admin/delete/:id",visible:0,menuType:2}]},{perms:"user:role",menuName:"角色管理",path:"/user/role",children:[{perms:"user:role:list",menuName:"角色列表",path:"/user/role/list",visible:0,menuType:1},{perms:"user:role:add",menuName:"添加角色",path:"/user/role/add",visible:0,menuType:2},{perms:"user:role:edit",menuName:"编辑角色",path:"/user/role/edit/:id",visible:0,menuType:2},{perms:"user:role:delete",menuName:"删除角色",path:"/user/role/delete/:id",visible:0,menuType:2}]}]},{perms:"system",menuName:"系统管理",path:"/system",children:[{perms:"system:menu",menuName:"菜单管理",path:"/system/menu",children:[{perms:"system:menu:list",menuName:"菜单列表",path:"/system/menu/list",visible:0,menuType:1},{perms:"system:menu:add",menuName:"添加菜单",path:"/system/menu/add",visible:0,menuType:2},{perms:"system:menu:edit",menuName:"编辑菜单",path:"/system/menu/edit/:id",visible:0,menuType:2},{perms:"system:menu:delete",menuName:"删除菜单",path:"/system/menu/delete/:id",visible:0,menuType:2}]},{perms:"system:department",menuName:"部门管理",path:"/system/department",children:[{perms:"system:department:list",menuName:"部门列表",path:"/system/department/list",visible:0,menuType:1},{perms:"system:department:add",menuName:"添加部门",path:"/system/department/add",visible:0,menuType:2},{perms:"system:department:edit",menuName:"编辑部门",path:"/system/department/edit/:id",visible:0,menuType:2},{perms:"system:department:delete",menuName:"删除部门",path:"/system/department/delete/:id",visible:0,menuType:2}]},{perms:"system:post",menuName:"岗位管理",path:"/system/post",children:[{perms:"system:post:list",menuName:"岗位列表",path:"/system/post/list",visible:0,menuType:1},{perms:"system:post:add",menuName:"添加岗位",path:"/system/post/add",visible:0,menuType:2},{perms:"system:post:edit",menuName:"编辑岗位",path:"/system/post/edit/:id",visible:0,menuType:2},{perms:"system:post:delete",menuName:"删除岗位",path:"/system/post/delete/:id",visible:0,menuType:2}]},{perms:"system:dict",menuName:"字典管理",path:"/system/dict",children:[{perms:"system:dict:list",menuName:"字典列表",path:"/system/dict/list",visible:0,menuType:1},{perms:"system:dict:add",menuName:"添加字典",path:"/system/dict/add",visible:0,menuType:2},{perms:"system:dict:edit",menuName:"编辑字典",path:"/system/dict/edit/:id",visible:0,menuType:2},{perms:"system:dict:delete",menuName:"删除字典",path:"/system/dict/delete/:id",visible:0,menuType:2}]},{perms:"system:log",menuName:"日志管理",path:"/system/log",children:[{perms:"system:log:list",menuName:"日志列表",path:"/system/log/list",visible:0,menuType:1}]}]}];t.migrateMenu=e=>r(void 0,void 0,void 0,(function*(){return e?(t.systemMenus.push(...e),t.systemMenus):[]}))},5307:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,i.default)(e)};const i=n(r(5677))},8056:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(4733)),o=n(r(8450)),u=new i.default,a=(0,o.default)({swaggerDefinition:{openapi:"3.0.0",info:{title:"NextCMS API Documentation",version:"1.0.0",description:"API documentation for NextCMS project"}},apis:["src/**/*.yaml"]});u.get("/swagger.json",(e=>{e.body=a})),t.default=u},6330:e=>{e.exports=require("@prisma/client")},5486:e=>{e.exports=require("bcrypt")},4166:e=>{e.exports=require("casbin")},1367:e=>{e.exports=require("casbin-prisma-adapter")},6293:e=>{e.exports=require("dayjs")},4469:e=>{e.exports=require("dotenv/config")},7659:e=>{e.exports=require("ioredis")},829:e=>{e.exports=require("jsonwebtoken")},6101:e=>{e.exports=require("koa")},8216:e=>{e.exports=require("koa-body")},4733:e=>{e.exports=require("koa-router")},1665:e=>{e.exports=require("koa2-swagger-ui")},2583:e=>{e.exports=require("sanitize-html")},8450:e=>{e.exports=require("swagger-jsdoc")},6982:e=>{e.exports=require("crypto")},9896:e=>{e.exports=require("fs")},6928:e=>{e.exports=require("path")}},t={};(function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports})(8156)})();